@page "/discount-dialog"
@using Radzen
@using ClubFitnessDomain
@inject DialogService DialogService

@code {
    [Parameter] public PosTransactionItem PosTransactionItem { get; set; }

    private string discountType = "By Price";
    private decimal? discount;
    private decimal discountValue;
    private string discountReason;

    private void ApplyDiscount()
    {
        discountValue = (discount ?? 0);
        // Implement the discount logic here, e.g., updating the Product object
        if (discountType == "By Price")
        {
            PosTransactionItem.Discount = discountValue;
            PosTransactionItem.DiscountPercentage = Math.Round((discountValue / PosTransactionItem.ItemPriceIncTax) * 100, 2); 
        }
        else if (discountType == "By Percentage %")
        {
            PosTransactionItem.DiscountPercentage = discountValue;
            PosTransactionItem.Discount = (PosTransactionItem.ItemPriceIncTax * discountValue) / 100;
        }
        else if (discountType == "By Amount $")
        {
            PosTransactionItem.Discount = discountValue;
            PosTransactionItem.DiscountPercentage = Math.Round((discountValue / PosTransactionItem.ItemPriceIncTax) * 100, 2);
        }

        // Close the dialog and send the updated product back
        DialogService.Close(PosTransactionItem);
        
    }

    private void Cancel()
    {
        DialogService.Close(null);
    }
}

<div class="p-3">
    
    <div class="form-group my-2">
        <RadzenNumeric TValue="decimal?" @bind-Value="discount" Style="width: 100%;" Placeholder="Discount value" />
    </div>

    <div class="form-group my-2">
        <RadzenTextArea Rows="3" @bind-Value="discountReason" Placeholder="Reason for discount" Style="width: 100%;" />
    </div>
    
    <RadzenRadioButtonList Data="@(new List<string> { "By Price", "By Percentage %", "By Amount $" })" 
                           @bind-Value="discountType" TValue="string" Orientation="Orientation.Vertical" />


    <div class="form-group mt-3 d-flex justify-content-end">
        <RadzenButton Text="Apply" Click="ApplyDiscount" ButtonStyle="ButtonStyle.Success" />
        <RadzenButton Text="Cancel" Click="Cancel" ButtonStyle="ButtonStyle.Danger" Style="margin-left: 10px;" />
    </div>
</div>
